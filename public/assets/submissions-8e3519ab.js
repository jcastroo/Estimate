import{n as a,b as m,d as _,f as v}from"./index-e0b9de87.js";import{c as i}from"./index-66fb023c.js";import"./_commonjsHelpers-53f7dec1.js";const g="_wrap_16593_1";const b={wrap:g,"scroll-container":"_scroll-container_16593_6","shadow-top":"_shadow-top_16593_10","shadow-right":"_shadow-right_16593_11","shadow-bottom":"_shadow-bottom_16593_12","shadow-left":"_shadow-left_16593_13","is-active":"_is-active_16593_59"};function c(s){if(typeof ResizeObserver==="undefined")return;return new ResizeObserver(t=>t.map(s))}const w={name:"ScrollShadow",props:{hideScrollbar:{type:Boolean,default:false},shadowTopOffset:{type:Number,default:0}},data(){return{width:void 0,height:void 0,shadow:{top:false,right:false,bottom:false,left:false},debounceTimeout:null}},mounted(){window.addEventListener("resize",this.calcDimensions);const s=c(this.toggleShadow);if(s){s.observe(this.$refs.scrollContainer);this.$once("hook:destroyed",()=>s.disconnect())}const t=c(this.calcDimensions);if(t){t.observe(this.$el);this.$once("hook:destroyed",()=>t.disconnect())}},destroyed(){window.removeEventListener("resize",this.calcDimensions)},methods:{async calcDimensions(){this.width=void 0;this.height=void 0;await this.$nextTick();this.width=`${this.$el.clientWidth}px`;this.height=`${this.$el.clientHeight}px`},toggleShadow(){const s=this.$refs.scrollContainer.clientWidth<this.$refs.scrollContainer.scrollWidth;const t=this.$refs.scrollContainer.clientHeight<this.$refs.scrollContainer.scrollHeight;const e=this.$refs.scrollContainer.offsetWidth+this.$refs.scrollContainer.scrollLeft;const r=this.$refs.scrollContainer.offsetHeight+this.$refs.scrollContainer.scrollTop;const o=this.$refs.scrollContainer.scrollTop===0;const n=e>=this.$refs.scrollContainer.scrollWidth;const d=r>=this.$refs.scrollContainer.scrollHeight;const f=this.$refs.scrollContainer.scrollLeft===0;this.$nextTick(()=>{this.shadow.top=t&&!o;this.shadow.right=s&&!n;this.shadow.bottom=t&&!d;this.shadow.left=s&&!f})}}};var y=function s(){var t=this,e=t._self._c;return e("div",{staticClass:"scroll-shadow max-w-full",class:[t.$style.wrap,{"w-max":!t.shadow.left&&!t.shadow.right}]},[e("div",{ref:"scrollContainer",class:[t.$style["scroll-container"],{"no-scrollbar":t.hideScrollbar}],style:{width:t.width?t.width:"auto",height:t.height},on:{"&scroll":function(r){return t.toggleShadow.apply(null,arguments)}}},[t._t("default"),e("span",{class:[t.$style["shadow-top"],t.shadow.top&&t.$style["is-active"]],style:{top:t.shadowTopOffset+"px"}}),e("span",{class:[t.$style["shadow-right"],t.shadow.right&&t.$style["is-active"]]}),e("span",{class:[t.$style["shadow-bottom"],t.shadow.bottom&&t.$style["is-active"]]}),e("span",{class:[t.$style["shadow-left"],t.shadow.left&&t.$style["is-active"]]})],2)])};var x=[];const u={"$style":b};function C(s){for(var t in u){this[t]=u[t]}}var $=a(w,y,x,false,C,null,null,null);const k=$.exports;const S={components:{},props:{value:{required:true}},data(){return{}},computed:{valueIsObject(){if(typeof this.value==="object"&&!Array.isArray(this.value)&&this.value!==null){return true}return false}},mounted(){},methods:{getColor(s){return{red:"#e03e3e",gray:"#9b9a97",brown:"#64473a",orange:"#d9730d",yellow:"#dfab01",teal:"#0f7b6c",blue:"#0b6e99",purple:"#6940a5",pink:"#ad1a72"}[s]},getBgColor(s){return{red:"#fbe4e4",gray:"#ebeced",brown:"#e9e5e3",orange:"#faebdd",yellow:"#fbf3db",teal:"#ddedea",blue:"#ddebf1",purple:"#eae4f2",pink:"#f4dfeb"}[s]}}};var O=function s(){var t=this,e=t._self._c;return!t.valueIsObject?e("span",[t._v(" "+t._s(t.value)+" ")]):e("span",t._l(t.value.responseData,function(r,o){return e("span",{key:o,class:{"font-semibold":r.annotations.bold&&!r.annotations.code,italic:r.annotations.italic,"line-through":r.annotations.strikethrough,underline:r.annotations.underline,"bg-pink-100 py-1 px-2 rounded-lg text-pink-500":r.annotations.code,"font-serif":r.type=="equation"},style:{color:r.annotations.color!="default"?t.getColor(r.annotations.color):null,"background-color":r.annotations.color!="default"&&r.annotations.color.split("_")[1]?t.getBgColor(r.annotations.color.split("_")[0]):"none"}},[r.href?e("a",{staticClass:"text-blue-600 underline",attrs:{"href":r.href,"rel":"noopener noreferrer","target":"_blank"}},[t._v(t._s(r.plain_text))]):!r.href?e("span",[t._v(t._s(r.plain_text))]):t._e()])}),0)};var D=[];var F=a(S,O,D,false,null,null,null,null);const l=F.exports;const L={components:{},props:{value:{required:true}},mounted(){},data(){return{}},computed:{},methods:{}};var I=function s(){var t=this,e=t._self._c;return e("a",{staticClass:"text-gray-700 dark:text-gray-300 hover:underline",attrs:{"href":t.value,"target":"_blank","rel":"nofollow"}},[t._v(t._s(t.value))])};var R=[];var z=a(L,I,R,false,null,null,null,null);const H=z.exports;const T={components:{},props:{opt:{type:String,required:true}},data(){return{}},computed:{},mounted(){},methods:{}};var E=function s(){var t=this,e=t._self._c;return e("span",{staticClass:"py-1 px-2 mb-1 open-tag default mr-2 text-gray-700 dark:text-gray-300 text-xs whitespace-nowrap rounded-md transition-colors",attrs:{"id":t.opt}},[t._v(" "+t._s(t.opt)+" ")])};var M=[];var j=a(T,E,M,false,null,null,null,null);const B=j.exports;const A={components:{OpenTag:B},props:{value:{type:Object|null,required:true}},data(){return{}},computed:{valueIsObject(){if(typeof this.value==="object"&&this.value!==null){return true}return false}},mounted(){},methods:{}};var q=function s(){var t=this,e=t._self._c;return t.value?e("span",{staticClass:"-mb-2"},[t.valueIsObject?t._l(t.value,function(r,o){return e("open-tag",{key:o,attrs:{"opt":r}})}):e("open-tag",{attrs:{"opt":t.value}})],2):t._e()};var P=[];var W=a(A,q,P,false,null,null,null,null);const p=W.exports;const U={components:{},props:{value:{required:true}},data(){return{}},computed:{valueIsObject(){if(typeof this.value==="object"&&this.value!==null){return true}return false}},mounted(){},methods:{}};var N=function s(){var t=this,e=t._self._c;return t.valueIsObject?e("span",[t.value[0]?[t._v(t._s(t.value[0]))]:t._e(),t.value[1]?[e("b",[t._v("to")]),t._v(" "+t._s(t.value[1]))]:t._e()],2):e("span",[t._v(" "+t._s(t.value)+" ")])};var J=[];var V=a(U,N,J,false,null,null,null,null);const X=V.exports;const Z={components:{},props:{value:{type:Array,required:false}},data(){return{}},computed:{},mounted(){},methods:{isImage(s){return["png","gif","jpg","jpeg","tif"].some(t=>{return s&&s.endsWith(t)})},displayedFileName(s){const t=s.substr(s.lastIndexOf(".")+1);const e=s.substr(0,s.lastIndexOf("."));if(e.length>12){return e.substr(0,12)+"(...)."+t}return e+"."+t}}};var G=function s(){var t=this,e=t._self._c;return e("p",{staticClass:"text-xs"},t._l(t.value,function(r){return e("span",{key:r.file_url,staticClass:"whitespace-nowrap rounded-md transition-colors hover:decoration-none",class:{"open-file text-gray-700 dark:text-gray-300 truncate":!t.isImage(r.file_url),"open-file-img":t.isImage(r.file_url)}},[e("a",{staticClass:"text-gray-700 dark:text-gray-300",attrs:{"href":r.file_url,"target":"_blank","rel":"nofollow"}},[t.isImage(r.file_url)?e("div",{staticClass:"w-8 h-8"},[e("img",{staticClass:"object-cover h-full w-full rounded",attrs:{"src":r.file_url}})]):e("span",{staticClass:"py-1 px-2"},[e("a",{attrs:{"href":r.file_url,"target":"_blank","download":""}},[t._v(t._s(t.displayedFileName(r.file_name)))])])])])}),0)};var K=[];var Q=a(Z,G,K,false,null,null,null,null);const h=Q.exports;const Y={components:{},props:{value:{required:true}},mounted(){},data(){return{}},computed:{},methods:{}};var tt=function s(){var t=this,e=t._self._c;return t.value===true?e("svg",{staticClass:"h-4 w-4 mx-auto",attrs:{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","stroke":"currentColor","stroke-width":"2"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","d":"M5 13l4 4L19 7"}})]):t.value===false?e("svg",{staticClass:"h-4 w-4 mx-auto",attrs:{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","stroke":"currentColor","stroke-width":"2"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","d":"M6 18L18 6M6 6l12 12"}})]):t._e()};var et=[];var st=a(Y,tt,et,false,null,null,null,null);const rt=st.exports;const ot={components:{},props:{allowResize:{required:true},width:{required:true}},data(){return{x:0,w:0}},computed:{},mounted(){},methods:{mouseDownHandler(s){this.x=s.clientX;const t=window.getComputedStyle(this.$refs.th);this.w=parseInt(t.width,10);document.addEventListener("mousemove",this.mouseMoveHandler);document.addEventListener("mouseup",this.mouseUpHandler)},mouseMoveHandler(s){const t=s.clientX-this.x;this.$emit("resize-width",this.w+t)},mouseUpHandler(){document.removeEventListener("mousemove",this.mouseMoveHandler);document.removeEventListener("mouseup",this.mouseUpHandler)}}};var nt=function s(){var t=this,e=t._self._c;return e("th",{ref:"th",style:{width:t.width}},[t._t("default"),t.allowResize?e("div",{staticClass:"absolute right-0 top-0 w-0 z-10"},[e("div",{staticClass:"resize-handler bg-transparent cursor-move hover:bg-blue-500 opacity-80 transition-colors",on:{"mousedown":t.mouseDownHandler}})]):t._e()],2)};var at=[];var lt=a(ot,nt,at,false,null,null,null,null);const it=lt.exports;const dt=function(s,t=0){let e=3735928559^t;let r=1103547991^t;for(let o=0,n;o<s.length;o++){n=s.charCodeAt(o);e=Math.imul(e^n,2654435761);r=Math.imul(r^n,1597334677)}e=Math.imul(e^e>>>16,2246822507)^Math.imul(r^r>>>13,3266489909);r=Math.imul(r^r>>>16,2246822507)^Math.imul(e^e>>>13,3266489909);return 4294967296*(2097151&r)+(e>>>0)};const ct={components:{ResizableTh:it},props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:false},allowResize:{required:false,default:true,type:Boolean}},data(){return{tableHash:null,skip:false}},computed:{form:{get(){return this.$store.state["open/working_form"].content},set(s){this.$store.commit("open/working_form/set",s)}},hasActions(){return false},fieldComponents(){return{text:l,number:l,select:p,multi_select:p,date:X,files:h,checkbox:rt,url:H,email:l,phone_number:l,signature:h}}},watch:{"form.properties":{handler(){this.onStructureChange()},deep:true},data(){this.$nextTick(()=>{this.handleScroll()})}},mounted(){const s=document.getElementById("table-page");this.tableHash=dt(JSON.stringify(this.form.properties));s.addEventListener("scroll",this.handleScroll,{passive:true});window.addEventListener("resize",this.handleScroll);this.onStructureChange();this.handleScroll()},beforeDestroy(){const s=document.getElementById("table-page");if(s){s.removeEventListener("scroll",this.handleScroll)}window.removeEventListener("resize",this.handleScroll)},methods:{colClasses(s){let t,e,r,o;t=`text-${s.alignment?s.alignment:"left"}`;e=null;if(!s.hasOwnProperty("color")||s.color==="default"){e="text-gray-700 dark:text-gray-300"}e=`text-${s.color}`;if(s.hasOwnProperty("bold")&&s.bold){r="font-semibold"}if(!s.hasOwnProperty("wrap_text")||!s.wrap_text){o="truncate"}return[t,e,o,r]},onStructureChange(){if(this.form.properties){this.$nextTick(()=>{this.form.properties.forEach(s=>{if(!s.hasOwnProperty("width")){if(this.allowResize&&this.form!==null&&document.getElementById("table-head-cell-"+s.id)){this.resizeCol(s,document.getElementById("table-head-cell-"+s.id).offsetWidth)}}})})}},resizeCol(s,t){if(!this.form)return;const e=i(this.form.properties);const r=this.form.properties.findIndex(o=>o.id===s.id);e[r].width=t;this.$set(this.form,"properties",e);this.$nextTick(()=>{this.$emit("resize")})},handleScroll(){const s=document.getElementById("table-page");const t=s.getBoundingClientRect().top;const e=Math.max(0,t-this.$refs.table.getBoundingClientRect().top);const r=document.getElementById("table-header-"+this.tableHash);if(r){r.style.transform=`translate3d(0px, ${e}px, 0px)`;if(e>0){r.classList.add("border-t")}else{r.classList.remove("border-t")}}if(this.$slots.hasOwnProperty("actions")){const o=document.getElementById("table-actions-"+this.tableHash);if(o){if(e>100){o.style.transform=`translate3d(0px, ${e+33}px, 0px)`}else{const n=document.getElementById("table-page");o.style.transform=`translate3d(0px, ${n.offsetHeight+(t-this.$refs.table.getBoundingClientRect().top)-35}px, 0px)`}}}}}};var ut=function s(){var t=this,e=t._self._c;return e("table",{ref:"table",staticClass:"notion-table n-table whitespace-no-wrap bg-white dark:bg-notion-dark-light relative",attrs:{"id":"table-"+t.tableHash}},[e("thead",{ref:"header",staticClass:"n-table-head top-0",class:{"absolute":t.data.length!==0},staticStyle:{"will-change":"transform","transform":"translate3d(0px, 0px, 0px)"},attrs:{"id":"table-header-"+t.tableHash}},[e("tr",{staticClass:"n-table-row overflow-x-hidden"},[t._l(t.form.properties,function(r,o){return e("resizable-th",{key:r.id,staticClass:"n-table-cell p-0 relative",attrs:{"id":"table-head-cell-"+r.id,"scope":"col","allow-resize":t.allowResize,"width":r.width?r.width+"px":"auto"},on:{"resize-width":function(n){return t.resizeCol(r,n)}}},[e("p",{staticClass:"bg-gray-50 dark:bg-notion-dark truncate sticky top-0 border-b border-gray-200 dark:border-gray-800 px-4 py-2 text-gray-500 font-semibold tracking-wider uppercase text-xs",class:{"border-r":o<t.form.properties.length-1||t.hasActions}},[t._v(" "+t._s(r.name)+" ")])])}),t.hasActions?e("th",{staticClass:"n-table-cell p-0 relative",staticStyle:{"width":"91px"}},[e("p",{staticClass:"bg-gray-50 dark:bg-notion-dark truncate sticky top-0 border-b border-gray-200 dark:border-gray-800 px-4 py-2 text-gray-500 font-semibold tracking-wider uppercase text-xs"},[t._v(" Actions ")])]):t._e()],2)]),t.data.length>0?e("tbody",{staticClass:"n-table-body bg-white dark:bg-notion-dark-light"},[t.$slots.hasOwnProperty("actions")?e("tr",{ref:"actions-row",staticClass:"action-row absolute w-full",staticStyle:{"will-change":"transform","transform":"translate3d(0px, 32px, 0px)"},attrs:{"id":"table-actions-"+t.tableHash}},[e("td",{staticClass:"p-1",attrs:{"colspan":t.form.properties.length}},[t._t("actions")],2)]):t._e(),t._l(t.data,function(r,o){return e("tr",{key:r.id,staticClass:"n-table-row",class:{"first":o===0}},t._l(t.form.properties,function(n,d){return e("td",{key:n.id,staticClass:"n-table-cell border-gray-100 dark:border-gray-900 text-sm p-2 overflow-hidden",class:[{"border-b":o!==t.data.length-1,"border-r":d!==t.form.properties.length-1||t.hasActions},t.colClasses(n)],style:{width:n.width+"px"}},[e(t.fieldComponents[n.type],{tag:"component",staticClass:"border-gray-100 dark:border-gray-900",attrs:{"property":n,"value":r[n.id]}})],1)}),0)}),t.loading?e("tr",{staticClass:"n-table-row border-t bg-gray-50 dark:bg-gray-900"},[e("td",{staticClass:"p-8 w-full",attrs:{"colspan":t.form.properties.length}},[e("loader",{staticClass:"w-4 h-4 mx-auto"})],1)]):t._e()],2):e("tbody",{key:"body-content",staticClass:"n-table-body"},[e("tr",{staticClass:"n-table-row loader w-full"},[e("td",{staticClass:"n-table-cell w-full p-8",attrs:{"colspan":t.form.properties.length}},[t.loading?e("loader",{staticClass:"w-4 h-4 mx-auto"}):e("p",{staticClass:"text-gray-500 text-center"},[t._v(" No data found. ")])],1)])])])};var pt=[];var ht=a(ct,ut,pt,false,null,null,null,null);const ft=ht.exports;const mt={name:"FormSubmissions",components:{ScrollShadow:k,OpenTable:ft,VSwitch:m},props:{},data(){return{formInitDone:false,isLoading:false,tableData:[],currentPage:1,fullyLoaded:false,showColumnsModal:false,properties:[],removed_properties:[],displayColumns:{}}},mounted(){this.initFormStructure();this.getSubmissionsData()},watch:{form(){if(this.form===null){return}this.initFormStructure();this.getSubmissionsData()}},computed:{form:{get(){return this.$store.state["open/working_form"].content},set(s){this.$store.commit("open/working_form/set",s)}},exportUrl(){if(!this.form){return""}return"/api/open/forms/"+this.form.id+"/submissions/export"}},methods:{initFormStructure(){if(!this.form||this.formInitDone){return}let s=false;this.form.properties.forEach(e=>{if(e.id==="created_at"){s=true}});if(!s){const e=i(this.form.properties);e.push({"name":"Created at","id":"created_at","type":"date","width":140});this.$set(this.form,"properties",e)}this.formInitDone=true;this.properties=i(this.form.properties);this.removed_properties=this.form.removed_properties?i(this.form.removed_properties):[];const t=window.localStorage.getItem("display-columns-formid-"+this.form.id);if(t!==null&&t){this.displayColumns=JSON.parse(t);this.onChangeDisplayColumns()}else{this.form.properties.forEach(e=>{this.displayColumns[e.id]=true})}},getSubmissionsData(){if(!this.form||this.fullyLoaded){return}this.isLoading=true;_.get("/api/open/forms/"+this.form.id+"/submissions?page="+this.currentPage).then(s=>{const t=s.data;this.tableData=this.tableData.concat(t.data.map(e=>e.data));if(this.currentPage<t.meta.last_page){this.currentPage+=1;this.getSubmissionsData()}else{this.isLoading=false;this.fullyLoaded=true}}).catch(s=>{console.error(s);this.isLoading=false})},dataChanged(){this.$refs.shadows.toggleShadow();this.$refs.shadows.calcDimensions()},onChangeDisplayColumns(){window.localStorage.setItem("display-columns-formid-"+this.form.id,JSON.stringify(this.displayColumns));const s=this.properties.concat(this.removed_properties).filter(t=>{return this.displayColumns[t.id]===true});this.$set(this.form,"properties",s)}}};var _t=function s(){var t=this,e=t._self._c;return e("div",{staticClass:"my-4 w-full mx-auto"},[e("h3",{staticClass:"font-semibold mb-4 text-xl"},[t._v(" Form Submissions "),t.form&&!t.isLoading&&t.tableData.length>0?e("span",{staticClass:"text-right text-xs uppercase mb-2"},[t._v(" - "),e("a",{attrs:{"href":t.exportUrl,"target":"_blank"}},[t._v("Export as CSV")])]):t._e(),t.form&&!t.isLoading&&t.formInitDone?e("span",{staticClass:"float-right text-xs uppercase mb-2"},[e("a",{attrs:{"href":"javascript:void(0);"},on:{"click":function(r){t.showColumnsModal=true}}},[t._v("Display columns")])]):t._e()]),e("modal",{attrs:{"show":t.showColumnsModal},on:{"close":function(r){t.showColumnsModal=false}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("svg",{staticClass:"w-8 h-8",attrs:{"viewBox":"0 0 24 24","fill":"none","xmlns":"http://www.w3.org/2000/svg"}},[e("path",{attrs:{"d":"M16 5H8C4.13401 5 1 8.13401 1 12C1 15.866 4.13401 19 8 19H16C19.866 19 23 15.866 23 12C23 8.13401 19.866 5 16 5Z","stroke":"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{"d":"M8 15C9.65685 15 11 13.6569 11 12C11 10.3431 9.65685 9 8 9C6.34315 9 5 10.3431 5 12C5 13.6569 6.34315 15 8 15Z","stroke":"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]},proxy:true},{key:"title",fn:function(){return[t._v(" Display columns ")]},proxy:true}])},[e("div",{staticClass:"px-4"},[t.properties.length>0?[e("h4",{staticClass:"font-bold mb-2"},[t._v("Form Fields")]),t._l(t.properties,function(r){return e("div",{key:r.id,staticClass:"p-2 border"},[t._v(" "+t._s(r.name)+" "),e("v-switch",{staticClass:"float-right",on:{"input":t.onChangeDisplayColumns},model:{value:t.displayColumns[r.id],callback:function(o){t.$set(t.displayColumns,r.id,o)},expression:"displayColumns[field.id]"}})],1)})]:t._e(),t.removed_properties.length>0?[e("h4",{staticClass:"font-bold mb-2 mt-4"},[t._v("Removed Fields")]),t._l(t.removed_properties,function(r){return e("div",{key:r.id,staticClass:"p-2 border"},[t._v(" "+t._s(r.name)+" "),e("v-switch",{staticClass:"float-right",on:{"input":t.onChangeDisplayColumns},model:{value:t.displayColumns[r.id],callback:function(o){t.$set(t.displayColumns,r.id,o)},expression:"displayColumns[field.id]"}})],1)})]:t._e()],2)]),!t.form||t.isLoading?e("loader",{staticClass:"h-6 w-6 text-nt-blue mx-auto"}):e("div",[e("scroll-shadow",{ref:"shadows",staticClass:"border max-h-full h-full notion-database-renderer",attrs:{"shadow-top-offset":0,"hide-scrollbar":true}},[e("open-table",{ref:"table",staticClass:"max-h-full",attrs:{"data":t.tableData,"loading":t.isLoading},on:{"resize":function(r){return t.dataChanged()}}})],1)],1)],1)};var vt=[];var gt=a(mt,_t,vt,false,null,null,null,null);const bt=gt.exports;const wt={components:{FormSubmissions:bt},props:{form:{type:Object,required:true}},mixins:[v],data:()=>({}),mounted(){},computed:{metaTitle(){return this.form?"Form Submissions - "+this.form.title:"Form Submissions"}},methods:{}};var yt=function s(){var t=this,e=t._self._c;return e("div",{attrs:{"id":"table-page"}},[e("form-submissions")],1)};var xt=[];var Ct=a(wt,yt,xt,false,null,null,null,null);const Ot=Ct.exports;export{Ot as default};
