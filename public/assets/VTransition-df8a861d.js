var x=Object.defineProperty;var k=(t,e,r)=>e in t?x(t,e,{enumerable:true,configurable:true,writable:true,value:r}):t[e]=r;var o=(t,e,r)=>{k(t,typeof e!=="symbol"?e+"":e,r);return r};import{n as d,t as y,d as I,_ as S}from"./index-e0b9de87.js";import{g as m}from"./vform.es-2ce0e762.js";import{c as v}from"./index-66fb023c.js";const D={name:"OpenFormButton",props:{color:{type:String,required:true},size:{type:String,default:"medium"},nativeType:{type:String,default:"submit"},loading:{type:Boolean,default:false},theme:{type:Object,default:()=>y.default}},computed:{buttonStyle(){return{backgroundColor:this.color,color:this.getTextColor(this.color),"--tw-ring-color":this.color}},sizes(){if(this.size==="small"){return{font:"sm","p-y":"1","p-x":"2"}}return{font:"base","p-y":"2","p-x":"4"}}},methods:{getTextColor(t,e="#FFFFFF",r="#000000"){const s=t.charAt(0)==="#"?t.substring(1,7):t;const a=parseInt(s.substring(0,2),16);const n=parseInt(s.substring(2,4),16);const w=parseInt(s.substring(4,6),16);const b=[a/255,n/255,w/255];const l=b.map(h=>{if(h<=.03928){return h/12.92}return Math.pow((h+.055)/1.055,2.4)});const F=.2126*l[0]+.7152*l[1]+.0722*l[2];return F>.45?r:e}}};var P=function t(){var e=this,r=e._self._c;return r("button",{staticClass:"btn",class:`py-${e.sizes["p-y"]} px-${e.sizes["p-x"]} text-${e.sizes["font"]} ${e.theme.Button.body}`,style:e.buttonStyle,attrs:{"type":e.nativeType,"disabled":e.loading},on:{"click":function(s){return e.$emit("click",s)}}},[!e.loading?[e._t("default")]:r("loader",{staticClass:"h-6 w-6 text-white mx-auto"})],2)};var q=[];var M=d(D,P,q,false,null,null,null,null);const T=M.exports;function _(t,e){if(t===void 0||t===null){return false}if(t.operatorIdentifier===void 0){return E(t.value,t.value?e[t.value.property_meta.id]:null)}if(t.operatorIdentifier==="and"){let r=true;t.children.forEach(s=>{if(!_(s,e)){r=false}});return r}else if(t.operatorIdentifier==="or"){let r=false;t.children.forEach(s=>{if(_(s,e)){r=true}});return r}throw new Error("Unexcepted operatorIdentifier:"+t.operatorIdentifier)}function E(t,e){if(!t){return false}switch(t.property_meta.type){case"text":case"url":case"email":case"phone_number":return Q(t,e);case"number":return X(t,e);case"checkbox":return Z(t,e);case"select":return V(t,e);case"date":return C(t,e);case"multi_select":return ee(t,e);case"files":return te(t,e)}return false}function c(t,e){return t.value===e}function f(t,e){return e?e.includes(t.value):false}function p(t,e){if(!e)return false;if(Array.isArray(t.value)){return t.value.every(r=>e.includes(r))}else{return e.includes(t.value)}}function G(t,e){return e.startsWith(t.value)}function L(t,e){return e&&e.endsWith(t.value)}function u(t,e){return!e||e.length===0}function O(t,e){return t.value&&e&&parseFloat(e)>parseFloat(t.value)}function B(t,e){return t.value&&e&&parseFloat(e)>=parseFloat(t.value)}function $(t,e){return t.value&&e&&parseFloat(e)<parseFloat(t.value)}function A(t,e){return t.value&&e&&parseFloat(e)<=parseFloat(t.value)}function R(t,e){return t.value&&e&&e>t.value}function H(t,e){return t.value&&e&&e<t.value}function Y(t,e){return t.value&&e&&e>=t.value}function z(t,e){return t.value&&e&&e<=t.value}function K(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r<=s&&r>=new Date(s.getFullYear(),s.getMonth(),s.getDate()-7)}function N(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r<=s&&r>=new Date(s.getFullYear(),s.getMonth()-1,s.getDate())}function W(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r<=s&&r>=new Date(s.getFullYear()-1,s.getMonth(),s.getDate())}function j(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r>=s&&r<=new Date(s.getFullYear(),s.getMonth(),s.getDate()+7)}function U(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r>=s&&r<=new Date(s.getFullYear(),s.getMonth()+1,s.getDate())}function J(t,e){if(!e)return false;const r=new Date(e);const s=new Date;return r>=s&&r<=new Date(s.getFullYear()+1,s.getMonth(),s.getDate())}function i(t,e,r="==="){if(!e||e.length===0)return false;switch(r){case"===":return e.length===parseInt(t.value);case"!==":return e.length!==parseInt(t.value);case">":return e.length>parseInt(t.value);case">=":return e.length>=parseInt(t.value);case"<":return e.length<parseInt(t.value);case"<=":return e.length<=parseInt(t.value)}return false}function Q(t,e){switch(t.operator){case"equals":return c(t,e);case"does_not_equal":return!c(t,e);case"contains":return f(t,e);case"does_not_contain":return!f(t,e);case"starts_with":return G(t,e);case"ends_with":return L(t,e);case"is_empty":return u(t,e);case"is_not_empty":return!u(t,e);case"content_length_equals":return i(t,e,"===");case"content_length_does_not_equal":return i(t,e,"!==");case"content_length_greater_than":return i(t,e,">");case"content_length_greater_than_or_equal_to":return i(t,e,">=");case"content_length_less_than":return i(t,e,"<");case"content_length_less_than_or_equal_to":return i(t,e,"<=")}return false}function X(t,e){switch(t.operator){case"equals":return c(t,e);case"does_not_equal":return!c(t,e);case"greater_than":return O(t,e);case"less_than":return $(t,e);case"greater_than_or_equal_to":return B(t,e);case"less_than_or_equal_to":return A(t,e);case"is_empty":return u(t,e);case"is_not_empty":return u(t,e);case"content_length_equals":return i(t,e,"===");case"content_length_does_not_equal":return i(t,e,"!==");case"content_length_greater_than":return i(t,e,">");case"content_length_greater_than_or_equal_to":return i(t,e,">=");case"content_length_less_than":return i(t,e,"<");case"content_length_less_than_or_equal_to":return i(t,e,"<=")}return false}function Z(t,e){switch(t.operator){case"equals":return c(t,e);case"does_not_equal":return!c(t,e)}return false}function V(t,e){switch(t.operator){case"equals":return c(t,e);case"does_not_equal":return!c(t,e);case"is_empty":return u(t,e);case"is_not_empty":return!u(t,e)}return false}function C(t,e){switch(t.operator){case"equals":return c(t,e);case"before":return R(t,e);case"after":return H(t,e);case"on_or_before":return Y(t,e);case"on_or_after":return z(t,e);case"is_empty":return u(t,e);case"past_week":return K(t,e);case"past_month":return N(t,e);case"past_year":return W(t,e);case"next_week":return j(t,e);case"next_month":return U(t,e);case"next_year":return J(t,e)}return false}function ee(t,e){switch(t.operator){case"contains":return p(t,e);case"does_not_contain":return!p(t,e);case"is_empty":return u(t,e);case"is_not_empty":return!u(t,e)}return false}function te(t,e){switch(t.operator){case"is_empty":return u(t,e);case"is_not_empty":return!u(t,e)}return false}class g{constructor(e,r){o(this,"conditionsMet",_);o(this,"property",null);o(this,"formData",null);o(this,"logic",false);this.property=e;this.formData=r;this.logic=e.logic!==void 0?e.logic:false}isHidden(){if(!this.logic){return this.property.hidden}const e=this.conditionsMet(this.logic.conditions,this.formData);if(e&&this.property.hidden&&this.logic.actions.length>0&&this.logic.actions.includes("show-block")){return false}else if(e&&!this.property.hidden&&this.logic.actions.length>0&&this.logic.actions.includes("hide-block")){return true}else{return this.property.hidden}}isRequired(){if(!this.logic){return this.property.required}const e=this.conditionsMet(this.logic.conditions,this.formData);if(e&&this.property.required&&this.logic.actions.length>0&&this.logic.actions.includes("make-it-optional")){return false}else if(e&&!this.property.required&&this.logic.actions.length>0&&this.logic.actions.includes("require-answer")){return true}else{return this.property.required}}}const re=(t,e=0)=>{let r=3735928559^e,s=1103547991^e;for(let a=0,n;a<t.length;a++){n=t.charCodeAt(a);r=Math.imul(r^n,2654435761);s=Math.imul(s^n,1597334677)}r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909);s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909);return 4294967296*(2097151&s)+(r>>>0)};const se={computed:{formPendingSubmissionKey(){return this.form?this.form.form_pending_submission_key+"-"+re(window.location.href):""}}};const ne=()=>S(()=>import("./vue-hcaptcha.common-9a2c2543.js").then(t=>t.v),true?["assets/vue-hcaptcha.common-9a2c2543.js","assets/_commonjsHelpers-53f7dec1.js"]:void 0);const ae={name:"Estimate",components:{OpenFormButton:T,VueHcaptcha:ne},mixins:[se],props:{form:{type:Object,required:true},theme:{type:Object,required:true},loading:{type:Boolean,required:true},showHidden:{type:Boolean,default:false},fields:{type:Array,required:true}},data(){return{dataForm:null,currentFieldGroupIndex:0,formVersionId:1,darkModeEnabled:document.body.classList.contains("dark"),isAutoSubmit:false}},computed:{hCaptchaSiteKey:()=>window.config.hCaptchaSiteKey,actualFields(){return this.fields.filter(t=>{return this.showHidden||!this.isFieldHidden[t.id]})},fieldGroups(){if(!this.actualFields)return[];const t=[];let e=[];this.actualFields.forEach(r=>{e.push(r);if(r.type==="nf-page-break"){t.push(e);e=[]}});t.push(e);return t},currentFields(){return this.fieldGroups[this.currentFieldGroupIndex]},currentFieldsPageBreak(){const t=this.currentFields[this.currentFields.length-1];if(t&&t.type==="nf-page-break")return t;return null},previousFieldsPageBreak(){if(this.currentFieldGroupIndex===0)return null;const t=this.fieldGroups[this.currentFieldGroupIndex-1];const e=t[t.length-1];if(e&&e.type==="nf-page-break")return e;return null},isLastPage(){return this.currentFieldGroupIndex===this.fieldGroups.length-1},fieldComponents(){return{text:"TextInput",number:"TextInput",select:"SelectInput",multi_select:"SelectInput",date:"DateInput",files:"FileInput",checkbox:"CheckboxInput",url:"TextInput",email:"TextInput",phone_number:"TextInput"}},isPublicFormPage(){return this.$route.name==="forms.show_public"},dataFormValue(){const t=this.dataForm.data();const e=this.fields.filter(r=>{return["select","multi_select"].includes(r.type)});e.forEach(r=>{if(t[r.id]!==void 0&&t[r.id]!==null&&Array.isArray(t[r.id])){t[r.id]=t[r.id].map(s=>{const a=r[r.type].options.find(n=>{return n.id===s});return a?a.name:s})}});return t},isFieldHidden(){const t={};this.fields.forEach(e=>{t[e.id]=new g(e,this.dataFormValue).isHidden()});return t},isFieldRequired(){const t={};this.fields.forEach(e=>{t[e.id]=new g(e,this.dataFormValue).isRequired()});return t}},watch:{form:{deep:true,handler(){this.initForm()}},fields:{deep:true,handler(){this.initForm()}},theme:{handler(){this.formVersionId++}},dataForm:{deep:true,handler(){if(this.isPublicFormPage&&this.form&&this.dataFormValue){try{window.localStorage.setItem(this.formPendingSubmissionKey,JSON.stringify(this.dataFormValue))}catch(t){}}}}},mounted(){this.initForm();if(window.location.href.includes("auto_submit=true")){this.isAutoSubmit=true;this.submitForm()}},methods:{submitForm(){if(this.currentFieldGroupIndex!==this.fieldGroups.length-1){return}if(this.form.use_captcha){this.dataForm["h-captcha-response"]=document.getElementsByName("h-captcha-response")[0].value;this.$refs.hcaptcha.reset()}if(this.form.editable_submissions&&this.form.submission_id){this.dataForm.submission_id=this.form.submission_id}this.$emit("submit",this.dataForm,this.onSubmissionFailure)},onSubmissionFailure(){this.isAutoSubmit=false;if(this.fieldGroups.length>1){let e=false;this.fieldGroups.forEach((r,s)=>{r.forEach(a=>{if(e)return;if(!e&&this.dataForm.errors.has(a.id)){this.currentFieldGroupIndex=s;e=true}})})}const t=document.getElementsByClassName("has-error");if(t.length>0){window.scroll({top:window.scrollY+t[0].getBoundingClientRect().top-60,behavior:"smooth"})}},async getSubmissionData(){if(!this.form||!this.form.editable_submissions||!this.form.submission_id){return null}await this.$store.dispatch("open/records/loadRecord",I.get("/api/forms/"+this.form.slug+"/submissions/"+this.form.submission_id).then(t=>{return{submission_id:this.form.submission_id,...t.data.data}}));return this.$store.getters["open/records/getById"](this.form.submission_id)},async initForm(){if(this.isPublicFormPage&&this.form.editable_submissions){const r=new URLSearchParams(window.location.search);if(r&&r.get("submission_id")){this.form.submission_id=r.get("submission_id");const s=await this.getSubmissionData();if(s!==null&&s){this.dataForm=new m(s);return}}}if(this.isPublicFormPage){let r;try{r=window.localStorage.getItem(this.formPendingSubmissionKey)}catch(s){r=null}if(r!==null&&r){r=JSON.parse(r);this.fields.forEach(s=>{if(s.type==="date"&&s.prefill_today===true){const a=new Date;let n=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0");if(s.with_time===true){n+="T"+String(a.getHours()).padStart(2,"0")+":"+String(a.getMinutes()).padStart(2,"0")}r[s.id]=n}});this.dataForm=new m(r);return}}const t=v(this.dataForm?this.dataForm.data():{});let e=null;if(this.isPublicFormPage&&this.form.is_pro){e=new URLSearchParams(window.location.search)}this.fields.forEach(r=>{if(r.type.startsWith("nf-")){return}if(e&&e.has(r.id)){if(r.type==="checkbox"){if(e.get(r.id)==="false"||e.get(r.id)==="0"){t[r.id]=false}else if(e.get(r.id)==="true"||e.get(r.id)==="1"){t[r.id]=true}}else{t[r.id]=e.get(r.id)}}else if(e&&e.has(r.id+"[]")){t[r.id]=e.getAll(r.id+"[]")}else if(r.type==="date"&&r.prefill_today===true){const s=new Date;let a=s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0");if(r.with_time===true){a+="T"+String(s.getHours()).padStart(2,"0")+":"+String(s.getMinutes()).padStart(2,"0")}t[r.id]=a}else{t[r.id]=r.prefill}});this.dataForm=new m(t)},getFieldComponents(t){if(t.type==="text"&&t.multi_lines){return"TextAreaInput"}if(t.type==="url"&&t.file_upload){return"FileInput"}if(t.type==="number"&&t.is_rating&&t.rating_max_value){return"RatingInput"}if(["select","multi_select"].includes(t.type)&&t.without_dropdown){return"FlatSelectInput"}if(t.type==="checkbox"&&t.use_toggle_switch){return"ToggleSwitchInput"}if(t.type==="signature"){return"SignatureInput"}return this.fieldComponents[t.type]},getFieldClasses(t){if(!t.width||t.width==="full")return"w-full px-2";else if(t.width==="1/2"){return"w-full sm:w-1/2 px-2"}else if(t.width==="1/3"){return"w-full sm:w-1/3 px-2"}else if(t.width==="2/3"){return"w-full sm:w-2/3 px-2"}else if(t.width==="1/4"){return"w-full sm:w-1/4 px-2"}else if(t.width==="3/4"){return"w-full sm:w-3/4 px-2"}},inputProperties(t){const e={key:t.id,name:t.id,form:this.dataForm,label:t.hide_field_name?null:t.name+(this.isFieldHidden[t.id]?" (Hidden Field)":""),color:this.form.color,placeholder:t.placeholder,help:t.help,uppercaseLabels:this.form.uppercase_labels,theme:this.theme,maxCharLimit:t.max_char_limit?parseInt(t.max_char_limit):2e3,showCharLimit:t.show_char_limit||false};if(["select","multi_select"].includes(t.type)){e.options=t.hasOwnProperty(t.type)?t[t.type].options.map(r=>{return{name:r.name,value:r.name}}):[];e.multiple=t.type==="multi_select";e.allowCreation=t.allow_creation===true;e.searchable=e.options.length>4}else if(t.type==="date"){if(t.with_time){e.withTime=true}else if(t.date_range){e.dateRange=true}if(t.disable_past_dates){e.disablePastDates=true}else if(t.disable_future_dates){e.disableFutureDates=true}}else if(t.type==="files"||t.type==="url"&&t.file_upload){e.multiple=t.multiple!==void 0&&t.multiple;e.mbLimit=5;e.accept=this.form.is_pro&&t.allowed_file_types?t.allowed_file_types:""}else if(t.type==="number"&&t.is_rating){e.numberOfStars=parseInt(t.rating_max_value)}return e},previousPage(){this.currentFieldGroupIndex-=1;window.scrollTo({top:0,behavior:"smooth"});return false},nextPage(){this.currentFieldGroupIndex+=1;window.scrollTo({top:0,behavior:"smooth"});return false}}};var ie=function t(){var e=this,r=e._self._c;return e.isAutoSubmit?r("div",[r("p",{staticClass:"text-center p-4"},[r("loader",{staticClass:"h-6 w-6 text-nt-blue mx-auto"})],1)]):e.dataForm?r("form",{on:{"submit":function(s){s.preventDefault()}}},[r("transition",{attrs:{"name":"fade","mode":"out-in","appear":""}},[e._l(e.fieldGroups,function(s,a){return[e.currentFieldGroupIndex===a?r("div",{key:a,staticClass:"form-group flex flex-wrap w-full"},[e._l(s,function(n){return[e.getFieldComponents(n)?r(e.getFieldComponents(n),e._b({key:n.id+e.formVersionId,tag:"component",class:e.getFieldClasses(n),attrs:{"required":e.isFieldRequired[n.id]}},"component",e.inputProperties(n),false)):[n.type==="nf-text"&&n.content?r("div",{key:n.id,staticClass:"nf-text w-full px-2 mb-3",attrs:{"id":n.id},domProps:{"innerHTML":e._s(n.content)}}):e._e(),n.type==="nf-code"&&n.content?r("div",{key:n.id,staticClass:"nf-code w-full px-2 mb-3",attrs:{"id":n.id},domProps:{"innerHTML":e._s(n.content)}}):e._e(),n.type==="nf-divider"?r("div",{key:n.id,staticClass:"border-b my-4 w-full mx-2",attrs:{"id":n.id}}):e._e(),n.type==="nf-image"&&(n.image_block||!e.isPublicFormPage)?r("div",{key:n.id,staticClass:"my-4 w-full px-2",attrs:{"id":n.id}},[!n.image_block?r("div",{staticClass:"p-4 border border-dashed"},[e._v(" Open "),r("b",[e._v(e._s(n.name)+"'s")]),e._v(" block settings to upload image. ")]):r("img",{staticClass:"max-w-full",attrs:{"alt":n.name,"src":n.image_block}})]):e._e()]]})],2):e._e()]})],2),e.form.use_captcha&&e.isLastPage?[r("div",{staticClass:"mb-3 px-2 mt-2 mx-auto w-max"},[r("vue-hcaptcha",{ref:"hcaptcha",attrs:{"sitekey":e.hCaptchaSiteKey,"theme":e.darkModeEnabled?"dark":"light"}}),r("has-error",{attrs:{"form":e.dataForm,"field":"h-captcha-response"}})],1)]:e._e(),r("div",{staticClass:"flex flex-wrap justify-center w-full"},[e.currentFieldGroupIndex>0&&e.previousFieldsPageBreak&&!e.loading?r("open-form-button",{staticClass:"mt-2 px-8 mx-1",attrs:{"native-type":"button","color":e.form.color,"theme":e.theme},on:{"click":e.previousPage}},[e._v(" "+e._s(e.previousFieldsPageBreak.previous_btn_text)+" ")]):e._e(),e.isLastPage?e._t("submit-btn",null,{"submitForm":e.submitForm}):r("open-form-button",{staticClass:"mt-2 px-8 mx-1",attrs:{"native-type":"button","color":e.form.color,"theme":e.theme},on:{"click":e.nextPage}},[e._v(" "+e._s(e.currentFieldsPageBreak.next_btn_text)+" ")]),!e.currentFieldsPageBreak&&!e.isLastPage?r("div",[e._v(" Something is wrong with this form structure. If you're the form owner please contact us. ")]):e._e()],2)],2):e._e()};var ue=[];var ce=d(ae,ie,ue,false,null,null,null,null);const ge=ce.exports;const oe={name:"VTransition",props:{name:{default:"slideInUp"}}};var le=function t(){var e=this,r=e._self._c;return e.name=="slideInUp"?r("transition",{attrs:{"enter-active-class":"linear duration-300 overflow-hidden","enter-class":"max-h-0","enter-to-class":"max-h-screen","leave-active-class":"linear duration-300 overflow-hidden","leave-class":"max-h-screen","leave-to-class":"max-h-0"}},[e._t("default")],2):e._e()};var he=[];var me=d(oe,le,he,false,null,null,null,null);const we=me.exports;export{se as F,T as O,we as V,ge as a};
